<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Array Variables</title>

<script type="text/javascript">
window.onload = function() {
  var imgs = document.getElementsByTagName('img'), i, img;
  for (i = 0; i < imgs.length; i++) {
    img = imgs[i];
    // center an image if it is the only element of its parent
    if (img.parentElement.childElementCount === 1)
      img.parentElement.style.textAlign = 'center';
  }
};
</script>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: #990073
   }

   pre .number {
     color: #099;
   }

   pre .comment {
     color: #998;
     font-style: italic
   }

   pre .keyword {
     color: #900;
     font-weight: bold
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: #d14;
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>



<style type="text/css">
@import url(../../lib/font/source-sans-pro/source-sans-pro.css);
@import url(http://fonts.googleapis.com/css?family=Inconsolata:400,700);

@font-face{
    font-family: 'AvenirLTStd';
    src: url(../../assets/AvenirLTPro-Heavy.ttf);
    font-weight: font-weight-heavy;
    font-style: normal;
  }
@font-face{
    font-family: 'AvenirLTStd';
    src: url(../../assets/AvenirLTPro-Roman.ttf);
    font-weight: font-weight-normal;
    font-style: normal;
  }


body, td {
   font-family: 'AvenirLTStd', 'Source Sans Pro', Helvetica, sans-serif;
   background-color: white;
   font-size: 13px;
}

body {
  color: #565656;
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 20px;
}

tt, code, pre {
   font-family: 'Inconsolata', 'Source Code Pro', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 {
   font-size:2.2em;
}

h2 {
   font-size:1.8em;
}

h3 {
   font-size:1.4em;
}

h4 {
   font-size:1.0em;
}

h5 {
   font-size:0.9em;
}

h6 {
   font-size:0.8em;
}

a:visited {
  color: #0064a4;
  text-decoration: none;
}

pre, img {
  max-width: 100%;
}
pre {
  overflow-x: auto;
}
pre code {
   display: block; padding: 0.5em;
}

code {
  font-size: 92%;
  border: 1px solid #ccc;
}

code[class] {
  background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

em {
  font-weight: bold;
  font-style: normal;
}
blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * {
      background: transparent !important;
      color: black !important;
      filter:none !important;
      -ms-filter: none !important;
   }

   body {
      font-size:12pt;
      max-width:100%;
   }

   a, a:visited {
      text-decoration: underline;
   }

   hr {
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote {
      padding-right: 1em;
      page-break-inside: avoid;
   }

   tr, img {
      page-break-inside: avoid;
   }

   img {
      max-width: 100% !important;
   }

   @page :left {
      margin: 15mm 20mm 15mm 10mm;
   }

   @page :right {
      margin: 15mm 10mm 15mm 20mm;
   }

   p, h2, h3 {
      orphans: 3; widows: 3;
   }

   h2, h3 {
      page-break-after: avoid;
   }
}
</style>



</head>

<body>
<!--
%\VignetteEngine{knitr::knitr}
%\VignetteIndexEntry{Array Variables}
-->

<p><a href="variables.md">Previous: variables</a></p>

<h1>Array Variables</h1>

<p>Crunch supports more types of variables than many of the data formats from which you can create datasets. Plain-text .csv files, for example, can&#39;t express that some columns are actually indicator matrices of multiple selections (Multiple Response Variables). Most SPSS .sav files do not indicate Categorical Arrays (otherwise known as &ldquo;grids&rdquo;) as being part of a group&mdash;they are simply several categorical variables. The same is true for an R <code>data.frame</code>.</p>

<p>You can use <code>crunch</code> to &ldquo;bind&rdquo; categorical variables into Multiple Response and Categorical Array variables.</p>

<h2>Creating an array</h2>

<p>One of the reasons to use R with Crunch is to leverage the power of scripting for tasks that would be repetitive in a GUI. Many crunch functions operating on Crunch datasets have an optional <code>pattern</code> argument that lets you use regular expressions for these &ldquo;bulk&rdquo; operations. </p>

<p>In our sample <em>Economist</em> dataset, we have set of variables prefixed with &ldquo;imiss&rdquo;:</p>

<pre><code class="r">grep(&quot;^imiss_&quot;, names(ds), value=TRUE)
</code></pre>

<pre><code>##  [1] &quot;imiss_b&quot; &quot;imiss_c&quot; &quot;imiss_d&quot; &quot;imiss_f&quot; &quot;imiss_g&quot; &quot;imiss_h&quot; &quot;imiss_j&quot;
##  [8] &quot;imiss_m&quot; &quot;imiss_p&quot; &quot;imiss_q&quot; &quot;imiss_r&quot; &quot;imiss_s&quot; &quot;imiss_t&quot;
</code></pre>

<p>These correspond to a survey grid question about how important respondents view a set of issues. Examining one of them, we see</p>

<pre><code class="r">ds$imiss_b
</code></pre>

<pre><code>## 
##  imiss_b (categorical) 
##  
## 
## 
</code></pre>

<pre><code>##                    Count
## Very Important       805
## Somewhat Important   164
## Not very Important    20
## Unimportant            6
</code></pre>

<p>All of these &ldquo;imiss&rdquo; categorical variables have the same structure. We can combine them into a categorical array variable with <code>makeArray</code>:</p>

<pre><code class="r">ds$imiss &lt;- makeArray(pattern=&quot;^imiss_&quot;, dataset=ds, name=&quot;Issue importance&quot;)
ds$imiss
</code></pre>

<pre><code>## 
##  Issue importance (categorical_array) 
##  
## 
##  
##  Subvariables: 
##    $`imiss_b`
##    $`imiss_c`
##    $`imiss_d`
##    $`imiss_f`
##    $`imiss_g`
##    $`imiss_h`
##    $`imiss_j`
##    $`imiss_m`
##    $`imiss_p`
##    $`imiss_q`
##    $`imiss_r`
##    $`imiss_s`
##    $`imiss_t`
</code></pre>

<p>In the Crunch web application, the set of &ldquo;important issue&rdquo; variables have gone from thirteen separate categorical variable cards to just one, where the subvariables are shown as rows, and the common categories across all of them are shown as columns:</p>

<p><img src="array-card.png" alt="Categorical Array variable card"/></p>

<p>The categorical variables <code>imiss_*</code> are now not visible in the dataset directly, but we can access them as &ldquo;subvariables&rdquo; of the array we just created.</p>

<pre><code class="r">subvariables(ds$imiss)
</code></pre>

<pre><code>## 
##  Subvariables: 
##    $`imiss_b`
##    $`imiss_c`
##    $`imiss_d`
##    $`imiss_f`
##    $`imiss_g`
##    $`imiss_h`
##    $`imiss_j`
##    $`imiss_m`
##    $`imiss_p`
##    $`imiss_q`
##    $`imiss_r`
##    $`imiss_s`
##    $`imiss_t`
</code></pre>

<p>We can also step into the subvariables and access the underlying categorical variables:</p>

<pre><code class="r">ds$imiss$imiss_b
</code></pre>

<pre><code>## 
##  imiss_b (categorical) 
##  
## 
## 
</code></pre>

<pre><code>##                    Count
## Very Important       805
## Somewhat Important   164
## Not very Important    20
## Unimportant            6
</code></pre>

<h2>Manipulating subvariables</h2>

<p>The names <code>imiss_b</code> through <code>imiss_t</code> are unsatisfying from a human-readability perspective: you can&#39;t tell which political issues correspond to the variables. Unfortunately, we didn&#39;t have additional metadata on these survey questions in the <code>data.frame</code> we imported initially. However, we can rectify this.</p>

<p>Subvariables have methods similar to those for <a href="variables.md">categories</a>. They have a names attribute that we can get:</p>

<pre><code class="r">names(subvariables(ds$imiss))
</code></pre>

<pre><code>##  [1] &quot;imiss_b&quot; &quot;imiss_c&quot; &quot;imiss_d&quot; &quot;imiss_f&quot; &quot;imiss_g&quot; &quot;imiss_h&quot; &quot;imiss_j&quot;
##  [8] &quot;imiss_m&quot; &quot;imiss_p&quot; &quot;imiss_q&quot; &quot;imiss_r&quot; &quot;imiss_s&quot; &quot;imiss_t&quot;
</code></pre>

<p>We can set it, too:</p>

<pre><code class="r">names(subvariables(ds$imiss)) &lt;- c(&quot;The economy&quot;, &quot;Immigration&quot;, 
    &quot;The environment&quot;, &quot;Terrorism&quot;, &quot;Gay rights&quot;, &quot;Education&quot;, 
    &quot;Health care&quot;, &quot;Social security&quot;, &quot;The budget deficit&quot;, 
    &quot;The war in Afghanistan&quot;, &quot;Taxes&quot;, &quot;Medicare&quot;, &quot;Abortion&quot;)
subvariables(ds$imiss)
</code></pre>

<pre><code>## 
##  Subvariables: 
##    $`The economy`
##    $`Immigration`
##    $`The environment`
##    $`Terrorism`
##    $`Gay rights`
##    $`Education`
##    $`Health care`
##    $`Social security`
##    $`The budget deficit`
##    $`The war in Afghanistan`
##    $`Taxes`
##    $`Medicare`
##    $`Abortion`
</code></pre>

<p>Another useful thing we can do with array subvariables is reorder them. Let&#39;s alphabetize the subvariables:</p>

<pre><code class="r">sorting &lt;- order(names(subvariables(ds$imiss)))
subvariables(ds$imiss) &lt;- subvariables(ds$imiss)[sorting]
subvariables(ds$imiss)
</code></pre>

<pre><code>## 
##  Subvariables: 
##    $`Abortion`
##    $`Education`
##    $`Gay rights`
##    $`Health care`
##    $`Immigration`
##    $`Medicare`
##    $`Social security`
##    $`Taxes`
##    $`Terrorism`
##    $`The budget deficit`
##    $`The economy`
##    $`The environment`
##    $`The war in Afghanistan`
</code></pre>

<h2>Creating multiple response variables</h2>

<p>Just as we created a categorical array, we can create a multiple response variable. Like categorical arrays, multiple responses contain a set of subvariables, categorical variables with a common list of categories. However, the subvariables in a multiple response are treated as dichotomous indicators. We specify one or more categories that indicate &ldquo;selected&rdquo; versus &ldquo;not selected&rdquo;. Hence, when a multiple response appears in the web app, it looks like a single categorical variable, each subvariable shown like a category. Unlike a categorical variable, though, the multiple responses are not mutually exclusive, so tabulations with them may not sum to 100 percent. </p>

<p>In the <em>Economist</em> dataset, we have another set of parallel categorical variables, &ldquo;boap&rdquo;, which indicate approval of President Obama on a range of issues. </p>

<pre><code class="r">ds$boap_4
</code></pre>

<pre><code>## 
##  boap_4 (categorical) 
##  
## 
## 
</code></pre>

<pre><code>##                     Count
## Strongly disapprove   283
## Somewhat approve      279
## Somewhat disapprove   160
## No opinion            157
## Strongly approve      113
</code></pre>

<p>In the questionnaire that collected this data, &ldquo;boap&rdquo; appeared as a grid question, just as &ldquo;imiss&rdquo; did. But, for illustration purposes&mdash;and to show how you can convert between categorical array and multiple response&mdash;let&#39;s treat this as multiple response. </p>

<p>The function <code>makeMR</code> works like <code>makeArray</code> but with an additional argument, &ldquo;selections&rdquo;, in which you specify the category name(s) that identify which category or categories should be the dichotomous indicator.</p>

<pre><code class="r">ds$boap &lt;- makeMR(pattern=&quot;^boap_[0-9]+&quot;, dataset=ds, 
    name=&quot;Approval of Obama on issues&quot;, 
    selections=c(&quot;Strongly approve&quot;, &quot;Somewhat approve&quot;))
ds$boap
</code></pre>

<pre><code>## 
##  Approval of Obama on issues (multiple_response) 
##  
## 
##  
##  Subvariables: 
##    $`boap_2`
##    $`boap_3`
##    $`boap_4`
##    $`boap_5`
##    $`boap_6`
##    $`boap_7`
##    $`boap_8`
##    $`boap_9`
##    $`boap_10`
##    $`boap_11`
##    $`boap_12`
##    $`boap_13`
##    $`boap_14`
</code></pre>

<h2>(un)dichotomize</h2>

<p>Multiple response variables can be thought of as categorical arrays that have extra metadata indicating which categories are &ldquo;selected&rdquo;. This metadata can be manipulated, and we can thus transform categorical arrays into multiple response and vice versa. </p>

<p>The function <code>undichotomize</code> removes the dichotomization metadata:</p>

<pre><code class="r">ds$boap &lt;- undichotomize(ds$boap)
ds$boap
</code></pre>

<pre><code>## 
##  Approval of Obama on issues (categorical_array) 
##  
## 
##  
##  Subvariables: 
##    $`boap_2`
##    $`boap_3`
##    $`boap_4`
##    $`boap_5`
##    $`boap_6`
##    $`boap_7`
##    $`boap_8`
##    $`boap_9`
##    $`boap_10`
##    $`boap_11`
##    $`boap_12`
##    $`boap_13`
##    $`boap_14`
</code></pre>

<p>We can add that information with <code>dichotomize</code>. Taking our categorical array &ldquo;boap,&rdquo; let&#39;s make it into a multiple response, but this time, let&#39;s only include the &ldquo;Strongly approve&rdquo; category:</p>

<pre><code class="r">ds$boap &lt;- dichotomize(ds$boap, &quot;Strongly approve&quot;)
ds$boap
</code></pre>

<pre><code>## 
##  Approval of Obama on issues (multiple_response) 
##  
## 
##  
##  Subvariables: 
##    $`boap_2`
##    $`boap_3`
##    $`boap_4`
##    $`boap_5`
##    $`boap_6`
##    $`boap_7`
##    $`boap_8`
##    $`boap_9`
##    $`boap_10`
##    $`boap_11`
##    $`boap_12`
##    $`boap_13`
##    $`boap_14`
</code></pre>

<h2>Splitting arrays back into categoricals</h2>

<p>As noted above, when we make an array, its subvariables no longer appear in the dataset outside of the array.</p>

<pre><code class="r">grep(&quot;boap&quot;, names(ds), value=TRUE)
</code></pre>

<pre><code>## [1] &quot;boap&quot;
</code></pre>

<p>We can access the subvariables and do things with them directly via the <code>subvariables</code> method, but the case may arise in which we want to undo our binding of these subvariables into the array. The function <code>unbind</code> deletes the array variable and restores the subvariables as top-level variables.</p>

<pre><code class="r">unbind(ds$boap)
ds &lt;- refresh(ds)
</code></pre>

<p>Note the use of <code>refresh</code>. Most functions that modify objects on the server refresh their local copies in our R session automatically; however, because <code>unbind</code> doesn&#39;t assign back into <code>ds</code>, the local dataset object doesn&#39;t get updated with the change, so we need to refresh it manually.</p>

<p>Now, if we check the names of <code>ds</code>, we see our full set of <code>boap_*</code> former subvariables:</p>

<pre><code class="r">grep(&quot;boap&quot;, names(ds), value=TRUE)
</code></pre>

<pre><code>##  [1] &quot;boap_2&quot;  &quot;boap_3&quot;  &quot;boap_4&quot;  &quot;boap_5&quot;  &quot;boap_6&quot;  &quot;boap_7&quot;  &quot;boap_8&quot; 
##  [8] &quot;boap_9&quot;  &quot;boap_10&quot; &quot;boap_11&quot; &quot;boap_12&quot; &quot;boap_13&quot; &quot;boap_14&quot;
</code></pre>

<p><a href="variable-order.md">Next: variable organization</a></p>

</body>

</html>
