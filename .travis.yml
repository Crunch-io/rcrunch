language: r
cache: packages
os:
  - linux
r:
- 3.3
- oldrel
- release
- devel
after_success:
- Rscript -e 'covr::codecov()'
- bash pkgdown.sh
env:
  global:
    - _R_CHECK_LENGTH_1_LOGIC2_=true
    - secure: BWvMPmOiTzFNfFz3Ok+WHk6FjNNjK8qV5QohBhS0bgsMgeCrx4Zu3IXp42cXaEzzCe/VEnnEyYYTkZROS3mdLRAlOHnEHvCJMtETOODOK6EFGUFDv+C7AXZyqbdoNPrGrW5QKppHAVbTuL/A9z+tnBaeyG68GhOmOFBk4mciHNc=

matrix:
    include:
        - os: windows
          language: shell
          env: 
            global: _R_CHECK_LENGTH_1_LOGIC2_=true
          before_install:
            - choco install -y r.project
            - export R_VERSION=`ls 'C:\Program Files\R\'`
            - export PATH=$PATH:';C:\Program Files\R\'$R_VERSION'\bin\x64'
            - echo 'options(repos = c("https://cloud.r-project.org"))' > ~/.Rprofile.site
            - export R_PROFILE=~/.Rprofile.site
        script:
            - Rscript.exe -e 'sessionInfo()'
            - Rscript.exe -e 'install.packages(c("devtools"));if (!all(c("devtools") %in% installed.packages())) { q(status = 1, save = "no")}'
            - Rscript.exe -e 'devtools::session_info(installed.packages()[, "Package"])'
            - R.exe CMD build 
            - Rscript -e 'deps <- devtools::dev_package_deps(dependencies = NA);devtools::install_deps(dependencies = TRUE)'
            - export PKG_TARBALL="$(perl -ne '$version = $1 if (/^Version:\s(\S+)/); $package = $1 if (/^Package:\s*(\S+)/); END { print "${package}_$version.tar.gz" }' DESCRIPTION)"
            - echo $PKG_TARBALL
            - R.exe CMD check "${PKG_TARBALL}" --as-cran
            
        after_success: echo 'Done!'