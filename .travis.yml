language: r
cache: packages
after_success:
- Rscript -e 'covr::codecov()'
- bash pkgdown.sh

# matrix to include a windows build this can be removed when 
# https://github.com/travis-ci/travis-build/pull/1538 is merged in
# the windows build steps are similar to what's in the PR and the process other
# oses use
matrix:
  include:
  - os: linux
    r: 3.3
    env:
      global: 
        - _R_CHECK_LENGTH_1_LOGIC2_=true
        - secure: BWvMPmOiTzFNfFz3Ok+WHk6FjNNjK8qV5QohBhS0bgsMgeCrx4Zu3IXp42cXaEzzCe/VEnnEyYYTkZROS3mdLRAlOHnEHvCJMtETOODOK6EFGUFDv+C7AXZyqbdoNPrGrW5QKppHAVbTuL/A9z+tnBaeyG68GhOmOFBk4mciHNc=
  - os: linux
    r: oldrel
    env:
      global: 
        - _R_CHECK_LENGTH_1_LOGIC2_=true
        - secure: BWvMPmOiTzFNfFz3Ok+WHk6FjNNjK8qV5QohBhS0bgsMgeCrx4Zu3IXp42cXaEzzCe/VEnnEyYYTkZROS3mdLRAlOHnEHvCJMtETOODOK6EFGUFDv+C7AXZyqbdoNPrGrW5QKppHAVbTuL/A9z+tnBaeyG68GhOmOFBk4mciHNc=
  - os: linux
    r: release
    env:
      global: 
        - _R_CHECK_LENGTH_1_LOGIC2_=true
        - secure: BWvMPmOiTzFNfFz3Ok+WHk6FjNNjK8qV5QohBhS0bgsMgeCrx4Zu3IXp42cXaEzzCe/VEnnEyYYTkZROS3mdLRAlOHnEHvCJMtETOODOK6EFGUFDv+C7AXZyqbdoNPrGrW5QKppHAVbTuL/A9z+tnBaeyG68GhOmOFBk4mciHNc=
  - os: linux
    r: devel
    env:
      global: 
        - _R_CHECK_LENGTH_1_LOGIC2_=true
        - secure: BWvMPmOiTzFNfFz3Ok+WHk6FjNNjK8qV5QohBhS0bgsMgeCrx4Zu3IXp42cXaEzzCe/VEnnEyYYTkZROS3mdLRAlOHnEHvCJMtETOODOK6EFGUFDv+C7AXZyqbdoNPrGrW5QKppHAVbTuL/A9z+tnBaeyG68GhOmOFBk4mciHNc=
  - os: windows
    language: shell
    env:
      global: _R_CHECK_LENGTH_1_LOGIC2_=true
    before_install:
      - choco install -y r.project
      - export R_VERSION=`ls 'C:\Program Files\R\'`
      - export PATH=$PATH:';C:\Program Files\R\'$R_VERSION'\bin\x64'
      - echo 'options(repos = c("https://cloud.r-project.org"))' > ~/.Rprofile.site
      - export R_PROFILE=~/.Rprofile.site
    script:
      - Rscript.exe -e 'sessionInfo()'
      - Rscript.exe -e 'install.packages(c("devtools"));if (!all(c("devtools") %in% installed.packages())) { q(status = 1, save = "no")}'
      - Rscript.exe -e 'devtools::session_info(installed.packages()[, "Package"])'
      - Rscript -e 'deps <- devtools::dev_package_deps(dependencies = NA);devtools::install_deps(dependencies = TRUE)'
      - R.exe CMD build . --no-manual
      - export PKG_TARBALL="$(perl -ne '$version = $1 if (/^Version:\s(\S+)/); $package = $1 if (/^Package:\s*(\S+)/); END { print "${package}_$version.tar.gz" }' DESCRIPTION)"
      - echo $PKG_TARBALL
      - R.exe CMD check $PKG_TARBALL --no-manual --as-cran --install-args=--build
    after_success: echo 'Done!'